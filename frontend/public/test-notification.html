<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šçŸ¥æ¸¬è©¦å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .btn:hover {
            transform: scale(1.05);
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .log-entry.success { color: #28a745; }
        .log-entry.error { color: #dc3545; }
        .log-entry.info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”” é€šçŸ¥åŠŸèƒ½å®Œæ•´æ¸¬è©¦å·¥å…·</h1>

        <div id="permissionStatus"></div>
        <div id="supportStatus"></div>

        <div style="margin: 20px 0;">
            <button class="btn" onclick="requestPermission()">1. è«‹æ±‚é€šçŸ¥æ¬Šé™</button>
            <button class="btn" onclick="testBasicNotification()">2. æ¸¬è©¦åŸºæœ¬é€šçŸ¥</button>
            <button class="btn" onclick="testAdvancedNotification()">3. æ¸¬è©¦é€²éšé€šçŸ¥</button>
            <button class="btn" onclick="checkWindowsFocus()">4. æª¢æŸ¥è¦–çª—ç„¦é»</button>
            <button class="btn" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>

        <h3>è¨ºæ–·æ—¥èªŒï¼š</h3>
        <div id="log" class="log"></div>

        <div style="margin-top: 30px; padding: 20px; background: #e7f3ff; border-radius: 5px;">
            <h3>ğŸ’¡ å¸¸è¦‹å•é¡Œæ’æŸ¥ï¼š</h3>
            <ol>
                <li><strong>Windows å°ˆæ³¨è¼”åŠ©æ¨¡å¼ï¼š</strong> Win + A æ‰“é–‹é€šçŸ¥ä¸­å¿ƒï¼Œç¢ºèªæœªé–‹å•Ÿå°ˆæ³¨è¼”åŠ©</li>
                <li><strong>ç³»çµ±é€šçŸ¥è¨­å®šï¼š</strong> Win + I â†’ ç³»çµ± â†’ é€šçŸ¥ï¼Œç¢ºèªé€šçŸ¥é–‹é—œå·²é–‹å•Ÿ</li>
                <li><strong>Chrome é€šçŸ¥è¨­å®šï¼š</strong> chrome://settings/content/notifications</li>
                <li><strong>ç€è¦½å™¨æœ€å°åŒ–ï¼š</strong> ç¢ºä¿ç€è¦½å™¨è¦–çª—ä¸æ˜¯æœ€å°åŒ–ç‹€æ…‹</li>
                <li><strong>è«‹å‹¿æ‰“æ“¾æ¨¡å¼ï¼š</strong> ç¢ºèªç³»çµ±æœªé–‹å•Ÿè«‹å‹¿æ‰“æ“¾æ¨¡å¼</li>
            </ol>
        </div>
    </div>

    <script>
        const logDiv = document.getElementById('log');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logDiv.innerHTML = '';
        }

        function checkSupport() {
            const supportDiv = document.getElementById('supportStatus');

            if (!('Notification' in window)) {
                supportDiv.className = 'status error';
                supportDiv.innerHTML = 'âŒ æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´é€šçŸ¥ API';
                log('ç€è¦½å™¨ä¸æ”¯æ´é€šçŸ¥ API', 'error');
                return false;
            }

            supportDiv.className = 'status success';
            supportDiv.innerHTML = 'âœ… ç€è¦½å™¨æ”¯æ´é€šçŸ¥ API';
            log('ç€è¦½å™¨æ”¯æ´é€šçŸ¥ API', 'success');
            return true;
        }

        function checkPermission() {
            const statusDiv = document.getElementById('permissionStatus');
            const permission = Notification.permission;

            log(`ç•¶å‰é€šçŸ¥æ¬Šé™ç‹€æ…‹: ${permission}`, 'info');

            if (permission === 'granted') {
                statusDiv.className = 'status success';
                statusDiv.innerHTML = 'âœ… é€šçŸ¥æ¬Šé™ï¼šå·²æˆäºˆ';
            } else if (permission === 'denied') {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = 'âŒ é€šçŸ¥æ¬Šé™ï¼šå·²æ‹’çµ•ï¼ˆè«‹åœ¨ç€è¦½å™¨è¨­å®šä¸­æ‰‹å‹•é–‹å•Ÿï¼‰';
            } else {
                statusDiv.className = 'status warning';
                statusDiv.innerHTML = 'âš ï¸ é€šçŸ¥æ¬Šé™ï¼šå°šæœªè©¢å•';
            }
        }

        async function requestPermission() {
            log('é–‹å§‹è«‹æ±‚é€šçŸ¥æ¬Šé™...', 'info');

            if (!checkSupport()) return;

            try {
                const permission = await Notification.requestPermission();
                log(`æ¬Šé™è«‹æ±‚çµæœ: ${permission}`, permission === 'granted' ? 'success' : 'error');
                checkPermission();

                if (permission === 'granted') {
                    log('æ¬Šé™æˆäºˆæˆåŠŸï¼ç¾åœ¨å¯ä»¥æ¸¬è©¦é€šçŸ¥äº†', 'success');
                }
            } catch (error) {
                log(`æ¬Šé™è«‹æ±‚å¤±æ•—: ${error.message}`, 'error');
            }
        }

        function testBasicNotification() {
            log('=== é–‹å§‹åŸºæœ¬é€šçŸ¥æ¸¬è©¦ ===', 'info');

            if (Notification.permission !== 'granted') {
                log('éŒ¯èª¤ï¼šé€šçŸ¥æ¬Šé™æœªæˆäºˆï¼Œè«‹å…ˆé»æ“Šã€Œè«‹æ±‚é€šçŸ¥æ¬Šé™ã€', 'error');
                alert('è«‹å…ˆæˆäºˆé€šçŸ¥æ¬Šé™ï¼');
                return;
            }

            try {
                log('å‰µå»ºé€šçŸ¥ç‰©ä»¶...', 'info');

                const notification = new Notification('ğŸ”” åŸºæœ¬æ¸¬è©¦é€šçŸ¥', {
                    body: 'é€™æ˜¯ä¸€å€‹åŸºæœ¬çš„æ¸¬è©¦é€šçŸ¥\næ™‚é–“ï¼š' + new Date().toLocaleTimeString(),
                    requireInteraction: true
                });

                log('é€šçŸ¥ç‰©ä»¶å·²å‰µå»º', 'success');

                notification.onshow = function() {
                    log('âœ… é€šçŸ¥å·²é¡¯ç¤ºï¼', 'success');
                };

                notification.onerror = function(e) {
                    log('âŒ é€šçŸ¥é¡¯ç¤ºæ™‚ç™¼ç”ŸéŒ¯èª¤: ' + e, 'error');
                };

                notification.onclick = function() {
                    log('âœ… é€šçŸ¥è¢«é»æ“Šäº†ï¼', 'success');
                    alert('æ­å–œï¼é€šçŸ¥åŠŸèƒ½æ­£å¸¸é‹ä½œ âœ…');
                    notification.close();
                };

                notification.onclose = function() {
                    log('é€šçŸ¥å·²é—œé–‰', 'info');
                };

            } catch (error) {
                log('âŒ å‰µå»ºé€šçŸ¥å¤±æ•—: ' + error.message, 'error');
            }
        }

        function testAdvancedNotification() {
            log('=== é–‹å§‹é€²éšé€šçŸ¥æ¸¬è©¦ ===', 'info');

            if (Notification.permission !== 'granted') {
                log('éŒ¯èª¤ï¼šé€šçŸ¥æ¬Šé™æœªæˆäºˆ', 'error');
                return;
            }

            try {
                // æ¸¬è©¦å¤šå€‹é€šçŸ¥é¸é …
                const options = {
                    body: 'é€™æ˜¯é€²éšæ¸¬è©¦é€šçŸ¥\nåŒ…å«å¤šç¨®é¸é …',
                    requireInteraction: true,
                    silent: false,
                    tag: 'test-' + Date.now(),
                    renotify: true,
                    vibrate: [200, 100, 200]
                };

                log('é€šçŸ¥é¸é …: ' + JSON.stringify(options, null, 2), 'info');

                const notification = new Notification('ğŸ’Š é€²éšæ¸¬è©¦é€šçŸ¥', options);

                notification.onshow = function() {
                    log('âœ… é€²éšé€šçŸ¥å·²é¡¯ç¤ºï¼', 'success');

                    // 3ç§’å¾Œç™¼é€å¦ä¸€å€‹é€šçŸ¥
                    setTimeout(() => {
                        log('ç™¼é€ç¬¬äºŒå€‹é€šçŸ¥...', 'info');
                        const n2 = new Notification('ğŸ”” ç¬¬äºŒå€‹æ¸¬è©¦é€šçŸ¥', {
                            body: 'å¦‚æœæ‚¨çœ‹åˆ°é€™å€‹ï¼Œè¡¨ç¤ºé€£çºŒé€šçŸ¥åŠŸèƒ½æ­£å¸¸',
                            requireInteraction: true
                        });
                    }, 3000);
                };

                notification.onerror = function(e) {
                    log('âŒ é€²éšé€šçŸ¥éŒ¯èª¤: ' + e, 'error');
                };

                notification.onclick = function() {
                    log('âœ… é€²éšé€šçŸ¥è¢«é»æ“Šï¼', 'success');
                    notification.close();
                };

            } catch (error) {
                log('âŒ é€²éšé€šçŸ¥æ¸¬è©¦å¤±æ•—: ' + error.message, 'error');
            }
        }

        function checkWindowsFocus() {
            log('=== æª¢æŸ¥è¦–çª—ç‹€æ…‹ ===', 'info');
            log('æ–‡æª”å¯è¦‹æ€§: ' + document.visibilityState, 'info');
            log('è¦–çª—ç„¦é»: ' + (document.hasFocus() ? 'æœ‰ç„¦é»' : 'ç„¡ç„¦é»'), 'info');
            log('è¦–çª—å¯¬åº¦: ' + window.innerWidth + 'px', 'info');
            log('è¦–çª—é«˜åº¦: ' + window.innerHeight + 'px', 'info');
            log('User Agent: ' + navigator.userAgent, 'info');

            // æª¢æŸ¥ Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    log('Service Workers: ' + registrations.length + ' å€‹', 'info');
                });
            }
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            log('=== é€šçŸ¥æ¸¬è©¦å·¥å…·å·²è¼‰å…¥ ===', 'success');
            checkSupport();
            checkPermission();

            log('ç€è¦½å™¨: ' + navigator.userAgent, 'info');
            log('ç•¶å‰æ™‚é–“: ' + new Date().toLocaleString(), 'info');
        });

        // ç›£è½å¯è¦‹æ€§è®ŠåŒ–
        document.addEventListener('visibilitychange', () => {
            log('é é¢å¯è¦‹æ€§è®Šæ›´: ' + document.visibilityState, 'info');
        });
    </script>
</body>
</html>
