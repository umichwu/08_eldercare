# ElderCare è³‡æ–™åº«æ–‡ä»¶

> **é‡è¦**: è³‡æ–™åº« Schema å·²æ•´åˆå®Œæˆï¼Œè«‹ä½¿ç”¨ä¸» Schema æ–‡ä»¶

## ğŸ“ æ–‡ä»¶èªªæ˜

### ä¸»è¦ Schemaï¼ˆè«‹ä½¿ç”¨é€™å€‹ï¼‰
```
supabase_complete_schema_with_auth_v4.sql
```

**é€™æ˜¯å”¯ä¸€éœ€è¦åŸ·è¡Œçš„ä¸»è¦ Schema æ–‡ä»¶**ï¼ŒåŒ…å«ï¼š
- âœ… ä½¿ç”¨è€…èªè­‰ç³»çµ±
- âœ… ç”¨è—¥æé†’ç³»çµ±ï¼ˆé•·æœŸ + çŸ­æœŸï¼‰
- âœ… å¿ƒéˆç…§è­·æ¨¡çµ„
- âœ… ç¤¾äº¤åŠŸèƒ½ï¼ˆå¥½å‹ã€å‹•æ…‹ã€ä¸€å°ä¸€èŠå¤©ï¼‰
- âœ… åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½
- âœ… åœ°ç†ä½ç½®è¿½è¹¤
- âœ… å®¶åº­å„€è¡¨æ¿
- âœ… é€šçŸ¥ç³»çµ±ï¼ˆFCM + Emailï¼‰
- âœ… æ‰€æœ‰ RLS æ”¿ç­–

### Migrationsï¼ˆå¯é¸ï¼‰
```
migrations/add_group_chat_support.sql
```

**ç¾¤çµ„èŠå¤©åŠŸèƒ½**ï¼ˆ2025-12-05 æ–°å¢ï¼‰:
- chat_groupsï¼ˆèŠå¤©ç¾¤çµ„ï¼‰
- chat_group_membersï¼ˆç¾¤çµ„æˆå“¡ï¼‰
- chat_group_invitesï¼ˆç¾¤çµ„é‚€è«‹ï¼‰
- ä¿®æ”¹ chat_messages è¡¨ä»¥æ”¯æ´ç¾¤çµ„è¨Šæ¯

---

## ğŸš€ åˆæ¬¡è¨­å®š

### æ­¥é©Ÿ 1: åŸ·è¡Œä¸» Schema
1. ç™»å…¥ Supabase Dashboard
2. å‰å¾€ SQL Editor
3. è¤‡è£½ `supabase_complete_schema_with_auth_v4.sql` çš„å…§å®¹
4. è²¼ä¸Šä¸¦åŸ·è¡Œ

### æ­¥é©Ÿ 2: åŸ·è¡Œç¾¤çµ„èŠå¤© Migrationï¼ˆå¦‚éœ€è¦ï¼‰
1. åœ¨ SQL Editor ä¸­
2. è¤‡è£½ `migrations/add_group_chat_support.sql` çš„å…§å®¹
3. è²¼ä¸Šä¸¦åŸ·è¡Œ

---

## ğŸ”„ è³‡æ–™åº«æ›´æ–°

### å¦‚æœæ‚¨å·²æœ‰èˆŠç‰ˆè³‡æ–™åº«
1. **å‚™ä»½æ‚¨çš„è³‡æ–™**ï¼ˆé‡è¦ï¼ï¼‰
2. åŸ·è¡Œæ–°çš„ migration æ–‡ä»¶
3. æ¸¬è©¦åŠŸèƒ½æ˜¯å¦æ­£å¸¸

### å…¨æ–°å®‰è£
ç›´æ¥åŸ·è¡Œä¸» Schema + ç¾¤çµ„èŠå¤© migration

---

## ğŸ“‹ Schema ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å…§å®¹ |
|------|------|----------|
| v5.0 | 2025-11-29 | æ–°å¢çŸ­æœŸç”¨è—¥ã€åœ–ç‰‡ä¸Šå‚³ã€åœ°ç†ä½ç½® |
| v4.0 | 2025-11-xx | ä¿®æ­£ RLS æ”¿ç­–ã€æ•´åˆå¿ƒéˆç…§è­· |
| v3.0 | 2025-xx-xx | æ–°å¢ç¤¾äº¤åŠŸèƒ½ |
| - | 2025-12-05 | æ–°å¢ç¾¤çµ„èŠå¤©æ”¯æ´ |

---

## ğŸ—‘ï¸ å·²æ•´åˆçš„ Schemaï¼ˆå·²ç§»è‡³ docs_deleteï¼‰

ä»¥ä¸‹æ–‡ä»¶çš„å…§å®¹å·²æ•´åˆåˆ°ä¸» Schemaï¼Œä¸éœ€è¦å–®ç¨åŸ·è¡Œï¼š

- ~~group_chat_schema.sql~~ â†’ å·²æ•´åˆï¼ˆä¸€å°ä¸€èŠå¤©éƒ¨åˆ†ï¼‰
- ~~short_term_medication_schema.sql~~ â†’ å·²æ•´åˆåˆ° v5.0
- ~~social_media_schema.sql~~ â†’ å·²æ•´åˆåˆ° v5.0
- ~~migrations/add_alerts_table.sql~~ â†’ å·²æ•´åˆ
- ~~migrations/add_direct_messages_table.sql~~ â†’ å·²æ•´åˆ
- ~~migrations/add_spiritual_care_tables.sql~~ â†’ å·²æ•´åˆ
- ~~migrations/add_last_sent_at_to_pending_invitations.sql~~ â†’ å·²æ•´åˆ

---

## ğŸ“Š ä¸»è¦è³‡æ–™è¡¨

### ä½¿ç”¨è€…ç›¸é—œ
- `user_profiles` - ä½¿ç”¨è€…å€‹äººè³‡æ–™
- `elders` - é•·è¼©è³‡æ–™
- `family_members` - å®¶å±¬è³‡æ–™
- `elder_family_relations` - é•·è¼©èˆ‡å®¶å±¬é—œä¿‚

### ç”¨è—¥ç®¡ç†
- `medications` - è—¥ç‰©è³‡æ–™
- `medication_reminders` - ç”¨è—¥æé†’
- `medication_logs` - æœè—¥è¨˜éŒ„

### ç¤¾äº¤åŠŸèƒ½
- `friendships` - å¥½å‹é—œä¿‚
- `pending_invitations` - å¥½å‹é‚€è«‹
- `posts` - ç¤¾äº¤å‹•æ…‹
- `post_reactions` - å‹•æ…‹åæ‡‰
- `post_comments` - å‹•æ…‹è©•è«–
- `chat_messages` - èŠå¤©è¨Šæ¯ï¼ˆä¸€å°ä¸€ï¼‰
- `chat_groups` - èŠå¤©ç¾¤çµ„ â­ æ–°å¢
- `chat_group_members` - ç¾¤çµ„æˆå“¡ â­ æ–°å¢

### å¿ƒéˆç…§è­·
- `emotional_journals` - æƒ…ç·’æ—¥èªŒ
- `spiritual_contents` - éˆæ€§å…§å®¹
- `mood_diaries` - å¿ƒæƒ…æ—¥è¨˜
- `conversations` - AI å°è©±è¨˜éŒ„
- `messages` - å°è©±è¨Šæ¯

### åœ°ç†ä½ç½®
- `location_history` - ä½ç½®æ­·å²
- `safe_zones` - å®‰å…¨å€åŸŸ
- `geofence_alerts` - åœ°ç†åœæ¬„è­¦ç¤º

### åœ–ç‰‡ä¸Šå‚³
- `uploaded_images` - ä¸Šå‚³çš„åœ–ç‰‡
- `medication_images` - è—¥ç‰©åœ–ç‰‡
- `mood_diary_images` - å¿ƒæƒ…æ—¥è¨˜åœ–ç‰‡

---

## ğŸ” Row Level Security (RLS)

æ‰€æœ‰è³‡æ–™è¡¨éƒ½å·²å•Ÿç”¨ RLSï¼Œç¢ºä¿ï¼š
- ä½¿ç”¨è€…åªèƒ½å­˜å–è‡ªå·±çš„è³‡æ–™
- å®¶å±¬å¯ä»¥æŸ¥çœ‹é—œè¯é•·è¼©çš„è³‡æ–™
- å¥½å‹å¯ä»¥æŸ¥çœ‹å½¼æ­¤çš„å…¬é–‹è³‡è¨Š
- ç¾¤çµ„æˆå“¡å¯ä»¥æŸ¥çœ‹ç¾¤çµ„è¨Šæ¯

---

## âš ï¸ æ³¨æ„äº‹é …

1. **åŸ·è¡Œå‰è«‹å‚™ä»½**: é›–ç„¶ Schema åŒ…å«æ¸…ç†èˆŠè³‡æ–™çš„é‚è¼¯ï¼Œä½†å¼·çƒˆå»ºè­°å…ˆå‚™ä»½
2. **æª¢æŸ¥æ¬Šé™**: ç¢ºä¿æ‚¨çš„ Supabase å¸³è™Ÿæœ‰è¶³å¤ æ¬Šé™åŸ·è¡Œ Schema
3. **ç’°å¢ƒè®Šæ•¸**: è¨˜å¾—åœ¨å¾Œç«¯è¨­å®šå°æ‡‰çš„ç’°å¢ƒè®Šæ•¸ï¼ˆSupabase URLã€Keys ç­‰ï¼‰
4. **æ¸¬è©¦**: åŸ·è¡Œå®Œæˆå¾Œï¼Œå»ºè­°å…ˆåœ¨æ¸¬è©¦ç’°å¢ƒæ¸¬è©¦æ‰€æœ‰åŠŸèƒ½

---

## ğŸ“ å•é¡Œå›å ±

å¦‚é‡åˆ°è³‡æ–™åº«å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. Supabase Logsï¼ˆæŸ¥çœ‹éŒ¯èª¤è¨Šæ¯ï¼‰
2. RLS æ”¿ç­–æ˜¯å¦æ­£ç¢º
3. å¤–éµç´„æŸæ˜¯å¦æ»¿è¶³

---

**æœ€å¾Œæ›´æ–°**: 2025-12-05
