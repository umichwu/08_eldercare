# ğŸ” Gemini API é—®é¢˜æ’æŸ¥æŒ‡å—

## å½“å‰é—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š`"å‚³é€å¤±æ•—ï¼Œè«‹é‡è©¦: ç„¡æ³•ç”¢ç”ŸAIå›æ‡‰ - è©³æƒ…: LLM API å‘¼å«å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key é…ç½®"`

**å·²ç¡®è®¤**ï¼š
- âœ… Render æ˜¾ç¤º "Gemini API Key: Configured"
- âœ… test-api.html æµ‹è¯• Gemini API Key æˆåŠŸ
- âœ… ä»£ç å·²æ¨é€å¹¶éƒ¨ç½²æˆåŠŸ

---

## ğŸ“‹ å®Œæ•´æ’æŸ¥æ­¥éª¤

### æ­¥éª¤ 1: ç¡®è®¤ Render ç¯å¢ƒå˜é‡

1. ç™»å…¥ [Render Dashboard](https://dashboard.render.com)
2. ç‚¹å‡» `eldercare-backend` æœåŠ¡
3. ç‚¹å‡»å·¦ä¾§ **"Environment"** æ ‡ç­¾
4. **ç¡®è®¤ä»¥ä¸‹å˜é‡å­˜åœ¨ä¸”æ­£ç¡®**ï¼š

```bash
LLM_PROVIDER=gemini
GEMINI_API_KEY=AIza... (ä½ çš„å®Œæ•´ API Key)
```

âš ï¸ **é‡è¦æ£€æŸ¥é¡¹**ï¼š
- [ ] `GEMINI_API_KEY` çš„å€¼æ˜¯å¦å®Œæ•´ï¼Ÿï¼ˆåº”è¯¥æ˜¯ 39 ä¸ªå­—ç¬¦ï¼‰
- [ ] `GEMINI_API_KEY` æ˜¯å¦ä»¥ `AIza` å¼€å¤´ï¼Ÿ
- [ ] æœ‰æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼Ÿ
- [ ] æ˜¯å¦ä¸ test-api.html æµ‹è¯•æˆåŠŸçš„ Key å®Œå…¨ä¸€è‡´ï¼Ÿ

### æ­¥éª¤ 2: æŸ¥çœ‹ Render éƒ¨ç½²æ—¥å¿—

1. åœ¨ Render Dashboardï¼Œç‚¹å‡»å·¦ä¾§ **"Logs"** æ ‡ç­¾
2. æŸ¥æ‰¾ä»¥ä¸‹å…³é”®æ—¥å¿—ï¼š

**åº”è¯¥çœ‹åˆ°çš„æ—¥å¿—ï¼ˆæ­£å¸¸ï¼‰**ï¼š
```
âœ… Gemini client initialized
ğŸ“‹ LLM Configuration:
   Current Provider: gemini
   Default Model: gemini-2.0-flash-exp
   Gemini API Key: Configured
```

**å¦‚æœçœ‹åˆ°é”™è¯¯æ—¥å¿—**ï¼š
```
âš ï¸  Gemini API key not configured
```
è¯´æ˜ç¯å¢ƒå˜é‡æ²¡æœ‰è®¾ç½®æˆåŠŸï¼Œå›åˆ°æ­¥éª¤ 1 é‡æ–°æ£€æŸ¥ã€‚

### æ­¥éª¤ 3: æµ‹è¯• API è°ƒç”¨

åœ¨ Render Logs ä¸­æŸ¥æ‰¾å…·ä½“çš„ API è°ƒç”¨æ—¥å¿—ï¼š

**åº”è¯¥çœ‹åˆ°ï¼ˆæˆåŠŸï¼‰**ï¼š
```
ğŸ“¨ æ”¶åˆ°è¨Šæ¯è«‹æ±‚: { conversationId: ..., userId: ..., llmProvider: 'gemini' }
ğŸ¤– ä½¿ç”¨ LLM æä¾›å•†: gemini
ğŸ¤– Generating response with gemini (gemini-2.0-flash-exp)
   Temperature: 0.7, MaxTokens: 500
   Messages count: 2
âœ… Response generated successfully from gemini
   Content length: 150 chars
âœ… è¨Šæ¯è™•ç†æˆåŠŸ
```

**å¦‚æœçœ‹åˆ°é”™è¯¯**ï¼š
```
âŒ LLM client not initialized for provider: gemini
   Available API Keys: { openai: true, gemini: false, deepseek: false }
```
è¯´æ˜ `GEMINI_API_KEY` æ²¡æœ‰è¢«æ­£ç¡®è¯»å–ã€‚

### æ­¥éª¤ 4: é‡æ–°éƒ¨ç½²

å¦‚æœä¿®æ”¹äº†ç¯å¢ƒå˜é‡ï¼š

1. ç¡®è®¤å·²ç‚¹å‡» **"Save Changes"**
2. Render åº”è¯¥ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²
3. å¦‚æœæ²¡æœ‰è‡ªåŠ¨éƒ¨ç½²ï¼Œç‚¹å‡» **"Manual Deploy"** â†’ **"Deploy latest commit"**
4. ç­‰å¾… 3-5 åˆ†é’Ÿéƒ¨ç½²å®Œæˆ
5. å†æ¬¡æŸ¥çœ‹ Logs ç¡®è®¤æ–°çš„é…ç½®å·²ç”Ÿæ•ˆ

### æ­¥éª¤ 5: æ¸…é™¤ç¼“å­˜å¹¶é‡è¯•

1. åœ¨æµè§ˆå™¨æ‰“å¼€ https://08-eldercare.vercel.app/
2. æŒ‰ **F12** æ‰“å¼€å¼€å‘è€…å·¥å…·
3. å³é”®ç‚¹å‡»æµè§ˆå™¨çš„åˆ·æ–°æŒ‰é’®
4. é€‰æ‹© **"æ¸…é™¤ç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"**
5. é‡æ–°ç™»å…¥å¹¶æµ‹è¯•å‘é€æ¶ˆæ¯

### æ­¥éª¤ 6: æ£€æŸ¥å‰ç«¯æ—¥å¿—

åœ¨æµè§ˆå™¨ Consoleï¼ˆF12ï¼‰ä¸­æŸ¥çœ‹æ—¥å¿—ï¼š

**åº”è¯¥çœ‹åˆ°ï¼ˆæˆåŠŸï¼‰**ï¼š
```
ğŸ“¦ è«‹æ±‚è³‡æ–™: { userId: "...", content: "ä½ å¥½", llmProvider: "gemini" }
ğŸŒ API å‘¼å«: POST /conversations/.../messages
âœ… API å›æ‡‰: { userMessage: {...}, assistantMessage: {...} }
```

**å¦‚æœçœ‹åˆ°é”™è¯¯**ï¼š
```
âŒ API éŒ¯èª¤å›æ‡‰: { error: "ç„¡æ³•ç”¢ç”Ÿ AI å›æ‡‰", details: "..." }
```

å¤åˆ¶å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ `details` å­—æ®µçš„å†…å®¹ã€‚

---

## ğŸ§ª å¿«é€Ÿæµ‹è¯•æ–¹æ³•

### æµ‹è¯• 1: ç›´æ¥æµ‹è¯• Health Endpoint

åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
https://eldercare-backend-8o4k.onrender.com/api/health
```

åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„å›åº”ï¼š
```json
{
  "status": "ok",
  "timestamp": "2025-01-...",
  "environment": "production",
  "llm": {
    "provider": "gemini",
    "available": true
  }
}
```

### æµ‹è¯• 2: ä½¿ç”¨ test-api.html

1. è®¿é—® https://08-eldercare.vercel.app/test-api.html
2. é€‰æ‹© "Google Gemini"
3. è¾“å…¥ç›¸åŒçš„ API Keyï¼ˆä¸ Render é…ç½®çš„å®Œå…¨ä¸€è‡´ï¼‰
4. æµ‹è¯•æ¶ˆæ¯ï¼š"æµ‹è¯•"
5. ç‚¹å‡» "ğŸ§ª ç›´æ¥æµ‹è¯• API Key"
6. ç¡®è®¤æµ‹è¯•æˆåŠŸ

---

## ğŸ”‘ API Key å¸¸è§é—®é¢˜

### é—®é¢˜ 1: Key æ ¼å¼é”™è¯¯

**æ­£ç¡®æ ¼å¼**ï¼š
```
AIzaSyC1234567890abcdefghijklmnopqrstuv
```

**é”™è¯¯ç¤ºä¾‹**ï¼š
- âŒ åŒ…å«ç©ºæ ¼ï¼š`AIza... ` æˆ– ` AIza...`
- âŒ åŒ…å«æ¢è¡Œï¼š`AIza...\n`
- âŒ æˆªæ–­ä¸å®Œæ•´ï¼š`AIza...xyz`ï¼ˆå°‘äº 39 ä¸ªå­—ç¬¦ï¼‰
- âŒ ä½¿ç”¨äº†ä¸åŒçš„ Keyï¼štest-api.html æµ‹è¯•çš„ Key å’Œ Render é…ç½®çš„ä¸ä¸€æ ·

### é—®é¢˜ 2: API Key æƒé™ä¸è¶³

1. è®¿é—® [Google AI Studio](https://aistudio.google.com/app/apikey)
2. ç¡®è®¤ API Key çš„çŠ¶æ€æ˜¯ "Active"
3. æ£€æŸ¥ API Key çš„é…é¢ä½¿ç”¨æƒ…å†µ
4. å¦‚æœè¶…å‡ºé…é¢ï¼Œç­‰å¾…é‡ç½®æˆ–åˆ›å»ºæ–°çš„ Key

### é—®é¢˜ 3: API Key è¿‡æœŸ

1. åˆ é™¤æ—§çš„ API Key
2. åˆ›å»ºæ–°çš„ API Key
3. æ›´æ–° Render ç¯å¢ƒå˜é‡
4. é‡æ–°éƒ¨ç½²

---

## ğŸ“ éœ€è¦æä¾›çš„ä¿¡æ¯

å¦‚æœé—®é¢˜ä»ç„¶æ— æ³•è§£å†³ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **Render Logs çš„å®Œæ•´é”™è¯¯ä¿¡æ¯**ï¼š
   - ä» `ğŸ“¨ æ”¶åˆ°è¨Šæ¯è«‹æ±‚` å¼€å§‹
   - åˆ° `âŒ ç”¢ç”Ÿ AI å›æ‡‰å¤±æ•—` ç»“æŸ
   - åŒ…æ‹¬æ‰€æœ‰ä¸­é—´çš„æ—¥å¿—

2. **æµè§ˆå™¨ Console çš„é”™è¯¯ä¿¡æ¯**ï¼š
   - æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
   - åˆ‡æ¢åˆ° Console æ ‡ç­¾
   - å¤åˆ¶æ‰€æœ‰çº¢è‰²çš„é”™è¯¯ä¿¡æ¯

3. **test-api.html æµ‹è¯•ç»“æœ**ï¼š
   - æˆªå›¾æµ‹è¯•æˆåŠŸçš„ç”»é¢
   - ç¡®è®¤ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª API Key

4. **Render ç¯å¢ƒå˜é‡æˆªå›¾**ï¼š
   - éšè— API Key çš„å¤§éƒ¨åˆ†å†…å®¹
   - åªæ˜¾ç¤ºå‰ 10 ä¸ªå­—ç¬¦ï¼š`AIzaSyC123...`

---

## âœ… è§£å†³åçš„éªŒè¯

é—®é¢˜è§£å†³åï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. **Render Logs**ï¼š
   ```
   âœ… Response generated successfully from gemini
   âœ… è¨Šæ¯è™•ç†æˆåŠŸ
   ```

2. **å‰ç«¯ç•Œé¢**ï¼š
   - èƒ½å¤Ÿæ­£å¸¸å‘é€å’Œæ¥æ”¶æ¶ˆæ¯
   - AI å›å¤çš„æ¶ˆæ¯ä¸‹æ–¹æ˜¾ç¤º "ğŸŒŸ Gemini" æ ‡ç­¾

3. **æµè§ˆå™¨ Console**ï¼š
   - æ²¡æœ‰çº¢è‰²é”™è¯¯ä¿¡æ¯
   - æ˜¾ç¤º `âœ… API å›æ‡‰æˆåŠŸ`

---

## ğŸ¯ æœ€å¯èƒ½çš„åŸå› 

æ ¹æ®ä½ çš„æè¿°ï¼Œæœ€å¯èƒ½çš„åŸå› æ˜¯ï¼š

1. **API Key å¤åˆ¶é”™è¯¯**ï¼š
   - Render é…ç½®çš„ Key å’Œ test-api.html æµ‹è¯•çš„ Key ä¸ä¸€è‡´
   - å»ºè®®ï¼šé‡æ–°å¤åˆ¶ç²˜è´´ï¼Œç¡®ä¿å®Œå…¨ä¸€è‡´

2. **ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ**ï¼š
   - ä¿®æ”¹åæ²¡æœ‰é‡æ–°éƒ¨ç½²
   - å»ºè®®ï¼šæ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²

3. **ç¼“å­˜é—®é¢˜**ï¼š
   - æ—§çš„é…ç½®è¢«ç¼“å­˜
   - å»ºè®®ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œé‡å¯ Render æœåŠ¡

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - å®Œæ•´éƒ¨ç½²æŒ‡å—
- [test-api.html](https://08-eldercare.vercel.app/test-api.html) - API Key æµ‹è¯•å·¥å…·
- [Google AI Studio](https://aistudio.google.com/app/apikey) - è·å– Gemini API Key
