<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡åŒ–æ¸¬è©¦ - ä¸è¼‰å…¥ Service Worker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç°¡åŒ–æ¸¬è©¦é é¢</h1>
        <p style="color: #666;">é€™å€‹é é¢ä¸æœƒè¼‰å…¥ Service Workerï¼Œç”¨ä¾†éš”é›¢å•é¡Œ</p>

        <div id="results"></div>

        <h2>æ¸¬è©¦æ­¥é©Ÿ</h2>
        <button onclick="testSupabase()">1. æ¸¬è©¦ Supabase è¼‰å…¥</button>
        <button onclick="testScripts()">2. æ¸¬è©¦ JS æª”æ¡ˆè¼‰å…¥</button>
        <button onclick="clearResults()">æ¸…é™¤çµæœ</button>

        <h2>è©³ç´° Console è¼¸å‡º</h2>
        <pre id="console-output"></pre>
    </div>

    <script>
        // ä¸è¨»å†Š Service Workerï¼
        console.log('âœ… é€™å€‹é é¢ä¸æœƒè¼‰å…¥ Service Worker');

        const resultsDiv = document.getElementById('results');
        const consoleOutput = document.getElementById('console-output');
        let logs = [];

        // æ•æ‰ console
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            logs.push('[LOG] ' + args.join(' '));
            originalLog.apply(console, args);
            updateConsole();
        };

        console.error = function(...args) {
            logs.push('[ERROR] ' + args.join(' '));
            originalError.apply(console, args);
            updateConsole();
        };

        console.warn = function(...args) {
            logs.push('[WARN] ' + args.join(' '));
            originalWarn.apply(console, args);
            updateConsole();
        };

        function updateConsole() {
            consoleOutput.textContent = logs.join('\n');
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function addStatus(type, title, message) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            resultsDiv.appendChild(div);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
            logs = [];
            updateConsole();
        }

        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', (event) => {
            console.error('âŒ å…¨åŸŸéŒ¯èª¤:', event.message);
            console.error('   æª”æ¡ˆ:', event.filename);
            console.error('   è¡Œè™Ÿ:', event.lineno, ':', event.colno);
            addStatus('error', 'éŒ¯èª¤åµæ¸¬',
                `${event.message}<br>æª”æ¡ˆ: ${event.filename}<br>è¡Œè™Ÿ: ${event.lineno}:${event.colno}`);
        });

        function testSupabase() {
            console.log('ğŸ” æ¸¬è©¦ Supabase CDN...');
            if (typeof window.supabase !== 'undefined') {
                console.log('âœ… Supabase å·²è¼‰å…¥');
                addStatus('success', 'Supabase CDN', 'âœ… Supabase å·²æˆåŠŸè¼‰å…¥');

                // æ¸¬è©¦å‰µå»º client
                try {
                    const testClient = window.supabase.createClient(
                        'https://test.supabase.co',
                        'test-key'
                    );
                    console.log('âœ… Supabase createClient å‡½æ•¸æ­£å¸¸');
                    addStatus('success', 'Supabase åŠŸèƒ½', 'âœ… createClient å‡½æ•¸æ­£å¸¸é‹ä½œ');
                } catch (err) {
                    console.error('âŒ Supabase createClient éŒ¯èª¤:', err);
                    addStatus('error', 'Supabase åŠŸèƒ½', 'âŒ createClient éŒ¯èª¤: ' + err.message);
                }
            } else {
                console.error('âŒ Supabase æœªè¼‰å…¥');
                addStatus('error', 'Supabase CDN', 'âŒ Supabase æœªè¼‰å…¥');
            }
        }

        function testScripts() {
            console.log('ğŸ” æ¸¬è©¦ JS æª”æ¡ˆè¼‰å…¥...');

            // æ¸¬è©¦å„å€‹æª”æ¡ˆ
            const tests = [
                { name: 'i18n.js', check: () => typeof window.i18n !== 'undefined' },
                { name: 'settings.js', check: () => typeof SettingsManager !== 'undefined' },
                { name: 'app.js', check: () => typeof window.initElderCareApp === 'function' }
            ];

            tests.forEach(test => {
                try {
                    if (test.check()) {
                        console.log(`âœ… ${test.name} å·²è¼‰å…¥`);
                        addStatus('success', test.name, 'âœ… å·²æˆåŠŸè¼‰å…¥');
                    } else {
                        console.error(`âŒ ${test.name} æœªè¼‰å…¥`);
                        addStatus('error', test.name, 'âŒ æœªè¼‰å…¥æˆ–æœªå®šç¾©å…¨åŸŸè®Šæ•¸');
                    }
                } catch (err) {
                    console.error(`âŒ ${test.name} æª¢æŸ¥éŒ¯èª¤:`, err);
                    addStatus('error', test.name, 'âŒ æª¢æŸ¥æ™‚ç™¼ç”ŸéŒ¯èª¤: ' + err.message);
                }
            });
        }

        console.log('âœ… æ¸¬è©¦é é¢å·²è¼‰å…¥');
        console.log('ğŸ’¡ è«‹æŒ‰ä¸Šæ–¹æŒ‰éˆ•é€²è¡Œæ¸¬è©¦');
    </script>

    <!-- è¼‰å…¥ Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- è¼‰å…¥å…¶ä»– JS æª”æ¡ˆ -->
    <script src="i18n.js"></script>
    <script src="settings.js"></script>
    <script src="app.js"></script>

    <script>
        // è‡ªå‹•åŸ·è¡Œæ¸¬è©¦
        setTimeout(() => {
            console.log('ğŸš€ è‡ªå‹•åŸ·è¡Œæ¸¬è©¦...');
            testSupabase();
            setTimeout(() => {
                testScripts();
            }, 500);
        }, 1000);
    </script>
</body>
</html>
